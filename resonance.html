<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üíñ Thi·ªáp 20/10 ‚Äî M√¥Ã£t moÃÅn quaÃÄ daÃÄnh cho emmm</title>

<meta property="og:title" content="‚ú® Open to see what‚Äôs inside" />
<meta property="og:description" content="M·ªü t·ª´ng c√°nh ƒë·ªÉ th·∫•y l·ªùi ch√∫c d√†nh ri√™ng cho em." />
<meta property="og:image" content="https://tungduy1704.github.io/Vietnam-Women-s-Day/og-image.jpg" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://tungduy1704.github.io/Vietnam-Women-s-Day/wish.html" />
<meta name="theme-color" content="#ff5aa5" />

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600..900&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box} html,body{margin:0; height:100%}
:root{
  --ink:#2a1a22; --soft:#fff6fb; --glass:rgba(255,255,255,.12);
  --accent:#ff5aa5; --accent-2:#b38bff; --accent-3:#58f8d1;
}
body{
  font-family: Nunito, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:#fff; background:#0f0a12; overflow:hidden;
}

/* ===== STARFIELD / HEART CANVAS BACKDROP ===== */
#bg{position:fixed; inset:0; z-index:0; background:radial-gradient(1200px 900px at 50% 40%, #3b2146, #0f0a12 75%)}

/* ===== LAYOUT ===== */
.app{ position:relative; z-index:2; display:flex; min-height:100vh; align-items:center; justify-content:center; padding:28px }
.shell{
  width:min(980px,100%); display:grid; grid-template-columns: 1.1fr .9fr;
  gap:20px; align-items:stretch;
}
@media (max-width:840px){ .shell{grid-template-columns:1fr; gap:16px} }

.card{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.18);
  border-radius:24px; padding:24px; backdrop-filter: blur(10px);
  box-shadow: 0 12px 50px rgba(0,0,0,.45);
}

/* ===== LEFT PANEL (TITLE) ===== */
.hero{
  position:relative; overflow:hidden; isolation:isolate;
}
.hero h1{
  font-family:"Playfair Display", serif; font-weight:800; letter-spacing:.3px;
  font-size: clamp(28px, 4vw, 42px); line-height:1.14; margin:10px 0 6px;
  background: linear-gradient(90deg, #fff, #ffd6e7, #e7d1ff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.badge{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 14px; border-radius:999px; font-weight:800; font-size:.95rem;
  background:linear-gradient(90deg, rgba(255,255,255,.2), rgba(255,255,255,.08));
  border:1px solid rgba(255,255,255,.22);
}
.hero .hi{ margin:8px 0 10px; font-size:1.05rem; color:#ffe9f5 }
.hero .name{ color:#fff; font-weight:900; }
.hero .msg{ font-style:italic; color:#ffe3f1 }

.hero .controls{ display:flex; flex-wrap:wrap; gap:10px; margin-top:16px }
.btn{
  padding:10px 14px; border:0; border-radius:14px; cursor:pointer; font-weight:800;
  color:#0f0a12; background:#fff; transition:.15s transform, .15s filter;
}
.btn:active{ transform:scale(.96) }
.btn.ghost{ background:transparent; color:#fff; border:1px solid rgba(255,255,255,.25) }

/* ===== TILES GRID ===== */
.grid{
  display:grid; gap:14px;
  grid-template-columns: repeat(2, minmax(0,1fr));
}
.tile{
  position:relative; background:linear-gradient(140deg, rgba(255,255,255,.16), rgba(255,255,255,.07));
  border:1px solid rgba(255,255,255,.22); border-radius:18px; padding:18px;
  min-height:120px; overflow:hidden; cursor:pointer; transform-style:preserve-3d;
  transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}
.tile:hover{ transform: translateY(-2px) rotate3d(1, -1, 0, 6deg); box-shadow: 0 12px 30px rgba(0,0,0,.35) }
.tile h3{ margin:6px 0 2px; font-size:1.12rem }
.tile p{ margin:0; opacity:.85; font-size:.96rem }
.tile .tag{ position:absolute; top:10px; right:10px; font-size:.8rem; opacity:.85 }
.tile .shine{
  position:absolute; inset:-20%; background: radial-gradient(400px 200px at var(--mx,50%) var(--my,50%),
   rgba(255,255,255,.25), transparent 60%); mix-blend-mode: screen; pointer-events:none;
}
.tile[data-kind="beauty"]{ border-color: rgba(255,90,165,.5) }
.tile[data-kind="strength"]{ border-color: rgba(179,139,255,.5) }
.tile[data-kind="success"]{ border-color: rgba(115,255,206,.5) }
.tile[data-kind="happiness"]{ border-color: rgba(255,218,124,.6) }
.tile[data-kind="shine"]{ border-color: rgba(255,255,255,.5) }

/* ===== REVEAL PANELS ===== */
.panel{
  position: fixed; inset: 0; display:none; place-items:center; z-index:5;
  background: rgba(0,0,0,.45); padding:22px;
}
.panel.active{ display:grid }
.panel .sheet{
  width:min(680px, 100%); border-radius:22px; padding:24px;
  background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.25); backdrop-filter: blur(14px);
  box-shadow: 0 20px 80px rgba(0,0,0,.55); position:relative; overflow:hidden;
}
.panel-image {
  display: block;
  width: 80%;
  max-width: 600px;
  max-height: 70vh;
  object-fit: cover;
  margin: 1.5rem auto 0;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.sheet h2{ margin:0 0 6px; font-size:1.6rem }
.sheet .lead{ margin:0 0 12px; opacity:.92 }
.sheet .body{ line-height:1.62 }
.close{
  position:absolute; top:12px; right:12px; border:0; border-radius:12px;
  background:rgba(255,255,255,.2); color:#fff; padding:8px 10px; cursor:pointer; font-weight:800;
}

/* small flourish line */
.hr{
  height:1px; width:100%; margin:12px 0 10px;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.45), transparent);
}

/* Flower hint strip when in-app */
.open-external {
  position:fixed; left:50%; transform:translateX(-50%);
  top:10px; z-index:10; background:rgba(255,255,255,.15);
  border:1px solid rgba(255,255,255,.25); color:#fff;
  border-radius:999px; padding:8px 14px; font-size:.9rem; display:none;
  backdrop-filter: blur(8px);
}
.open-external a{ color:#fff; font-weight:800; text-decoration:underline }

/* Corner controls */
.play-btn{
  position:fixed; right:16px; bottom:16px; z-index:10;
  padding:12px 16px; border:0; border-radius:999px; font-weight:800; cursor:pointer;
  color:#0f0a12; background:#fff; box-shadow:0 16px 40px rgba(0,0,0,.4)
}

/* accessibility */
@media (prefers-reduced-motion: reduce){
  .tile:hover{ transform:none }
}
</style>
</head>
<body>
<canvas id="bg" aria-hidden="true"></canvas>

<!-- Audio -->
<audio id="bgm" preload="auto" playsinline loop
  src="music.mp3"></audio>

<!-- in-app hint -->
<div id="ext" class="open-external" role="alert">
  N·∫øu kh√¥ng nghe nh·∫°c, h√£y <a id="openExternal" href="#" rel="noopener">m·ªü b·∫±ng tr√¨nh duy·ªát ngo√†i</a>.
</div>

<!-- corner button -->
<button id="play" class="play-btn" aria-label="Ph√°t nh·∫°c n·ªÅn">üîà Ph√°t nh·∫°c</button>

<div class="app">
  <div class="shell">

    <!-- LEFT: Title / intro -->
    <section class="card hero" aria-label="L·ªùi ch√∫c 20/10">
      <span class="badge">20 ‚Ä¢ 10 ‚Ä¢ <span id="year"></span></span>
      <h1>G·ª≠i emmmm b√¥ng hoa ƒë·∫πp nh·∫•t</h1>
      <p class="hi">G·ª≠i <span class="name" id="toName2">H·∫±ng</span>, <span class="msg" id="shortMsg">Mong nh·ªØng s·ª± ƒëang y√™u n√†y m√† anh l√©n chu·∫©n b·ªã cho em, nh·ªØng m√≥n qu√† m√† anh t·∫∑ng c√≥ th·ªÉ √¥m ·∫•p v√† xua tan ƒëi nh·ªØng √°p l·ª±c quanh em ‚ù§Ô∏è </span></p>
      <div class="hr"></div>
      <div class="controls">
        <!-- <button class="btn" id="share"></button>
        <button class="btn ghost" id="copy"></button> -->
        <!-- <button class="btn ghost" id="confetti">üéâ R·∫Øc kim tuy·∫øn</button> -->
      </div>
    </section>

    <!-- RIGHT: Interactive tiles -->
    <section class="card">
      <div class="grid" id="grid">
        <!-- Tiles are generated by JS for cleaner structure -->
      </div>
    </section>

  </div>
</div>

<!-- Reveal Panel -->
<div class="panel" id="panel" aria-modal="true" role="dialog" aria-hidden="true">
  <div class="sheet">
    <button class="close" id="close">‚úï</button>
    <h2 id="ph"></h2>
    <p class="lead" id="pl"></p>
    <div class="hr"></div>
    <div class="body" id="pb"></div>
  </div>
</div>

<script>
/* ===== Utils ===== */
const $  = s => document.querySelector(s);
const bg = $('#bg'), ctx = bg.getContext('2d');
const bgm= $('#bgm'), playBtn = $('#play');
const ext= $('#ext'), openExt=$('#openExternal');
const panel=$('#panel'), ph=$('#ph'), pl=$('#pl'), pb=$('#pb');
const yearEl=$('#year'); yearEl.textContent = new Date().getFullYear();

function isInApp(){return /zalo|fbav|line|instagram|tiktok|micromessenger/i.test(navigator.userAgent);}
function openInBrowser(e){e.preventDefault(); window.open(location.href,'_blank');}
function setPlayingUI(p){ playBtn.textContent = p ? "üîä ƒêang ph√°t" : "üîà Ph√°t nh·∫°c"; }

function fadeTo(vol, ms=900){
  const steps=28, start=bgm.volume||0, step=(vol-start)/steps;
  let i=0; const iv=setInterval(()=>{
    i++; bgm.volume = Math.max(0, Math.min(1, start + step*i));
    if(i>=steps){ bgm.volume = vol; clearInterval(iv); }
  }, Math.max(16, ms/steps));
}
async function autoplayMuted(){
  try{ bgm.muted=true; bgm.volume=0.0; await bgm.play(); setPlayingUI(true);}catch{ setPlayingUI(false); }
}
async function unmuteAndFade(){
  try{
    if(bgm.paused) await bgm.play();
    if(bgm.muted || bgm.volume===0){ bgm.muted=false; fadeTo(.44,900); setPlayingUI(true); }
    else{ if(!bgm.paused){ bgm.pause(); setPlayingUI(false);} else { await bgm.play(); setPlayingUI(true);} }
  }catch{}
}
function attachFirstInteraction(){
  const once = async () => { await unmuteAndFade(); cleanup(); };
  const cleanup = () => evts.forEach(e=>document.removeEventListener(e, once));
  const evts=['pointerdown','touchstart','click','keydown','scroll'];
  evts.forEach(e=>document.addEventListener(e, once, {once:true, passive:true}));
}

/* ===== Personalized params ===== */
function params(){
  const u=new URL(location.href);
  return {
    to:  u.searchParams.get('to'),
    msg: u.searchParams.get('msg')
  };
}
function personalize(){
  const p = params();
  if(p.to){ $('#toName').textContent=p.to; $('#toName2').textContent=p.to; }
  if(p.msg){ $('#shortMsg').textContent=p.msg; }
}

/* ===== Share & Copy ===== */
async function copyLink(){
  try{ await navigator.clipboard.writeText(location.href); }
  catch{ const t=document.createElement('textarea'); t.value=location.href; document.body.appendChild(t); t.select(); document.execCommand('copy'); t.remove(); }
}
async function sharePage(){
  // const p=params(); const title="Thi·ªáp 20/10 üíñ";
  // const text=`G·ª≠i ${p.to||"em"} ‚Äî M√¥Ã£t moÃÅn quaÃÄ daÃÄnh cho baÃ£n.`;
  // if(navigator.share){ try{ await navigator.share({title, text, url:location.href}); }catch{} }
  // else{ await copyLink(); alert("ƒê√£ sao ch√©p li√™n k·∫øt v√†o clipboard!"); }
}

/* ===== Confetti (emoji burst) ===== */
const emojis=['üå∏','üå∫','üå∑','üíê','üåº','üíñ','‚ú®','ü¶ã'];
function burst(n=36){ for(let i=0;i<n;i++) setTimeout(()=>particle(), i*35); }
function particle(){
  const d=document.createElement('div');
  d.textContent=emojis[Math.random()*emojis.length|0];
  d.style.position='fixed'; d.style.left=(Math.random()*100)+'%'; d.style.top='-10px'; d.style.zIndex=12;
  d.style.fontSize=(20+Math.random()*20)+'px';
  d.style.transition='transform 2.6s ease, opacity 2.6s ease';
  document.body.appendChild(d);
  requestAnimationFrame(()=>{
    const x=(Math.random()*2-1)*200, y=window.innerHeight+80;
    d.style.transform=`translate(${x}px, ${y}px) rotate(${Math.random()*720-360}deg)`;
    d.style.opacity=0;
  });
  setTimeout(()=>d.remove(), 2700);
}

/* ===== Tiles content ===== */
const tiles = [
  {
    kind:'beauty',  title:'V·∫ª ƒë·∫πp r·∫°ng r·ª°', lead:'M·ªôt n·ª• c∆∞·ªùi l√†m anh m√™ ƒë·∫Øm.',
    body:`Khi nh√¨n th·∫•y <b>em</b> em c∆∞·ªùi n√≥ nh∆∞ b√¥ng hoa.
    Ch√∫c em lu√¥n lu√¥n vui c∆∞·ªùi v√† lu√¥n l√† ch√≠nh m√¨nh. ‚ú®`,
    image: 'https://scontent.fhan14-3.fna.fbcdn.net/v/t39.30808-6/503820896_2124073528105928_7284284192565484200_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=833d8c&_nc_ohc=V5vVY9wR_b4Q7kNvwF-Eqwm&_nc_oc=AdlpTH8wOeKle3Lt81QhZvlQlaACUlrGNTbwmJRcD_CoIKdTh2Ib_VndOp9aWHxrEx1QrEdvD_UhCw0-ROPEMQ8B&_nc_zt=23&_nc_ht=scontent.fhan14-3.fna&_nc_gid=88ssCYI6wJK8ZAEgiEK-WA&oh=00_Afc71Gtgh_ViLr_s96spsQfXki0_5lXGYLwhAPvnCAhb6g&oe=68FAD555'
  },
  {
    kind:'strength', title:'S·ª©c m·∫°nh n·ªôi t√¢m', lead:'V·ªØng v√†ng v√† d·ªãu d√†ng.',
    body:`S·ª©c m·∫°nh c·ªßa em kh√¥ng ph·∫£i ·ªìn √†o, m√† l√† <b>b·ªÅn b·ªâ</b>.
    Ch√∫c em ƒë·ªß can ƒë·∫£m n√≥i ‚Äúkh√¥ng‚Äù, ƒë·ªß d·ªãu d√†ng n√≥i ‚Äúƒë∆∞·ª£c‚Äù, v√† ƒë·ªß b√¨nh y√™n ƒë·ªÉ m·ªâm c∆∞·ªùi. üí™`,
    image: 'https://scontent.fhan14-1.fna.fbcdn.net/v/t39.30808-6/484435919_2059883294524952_3914534721199078384_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=833d8c&_nc_ohc=IKvV-9-1WhwQ7kNvwGCMw0g&_nc_oc=AdleiajwM1ToOi44zBEswSER_CnNQ82CltxTqQJhs9Mo58ik1GJo11bUNeYf4kU4n3oGNdq9eRmodvF1HKG2Yxq_&_nc_zt=23&_nc_ht=scontent.fhan14-1.fna&_nc_gid=Z7oU-ZwaRDTR-eLWAc92ww&oh=00_AfcEvQd2GzzzUxytSqTIJ3yHRK-59jfYtV1FntlAu_mDUQ&oe=68FAC0D2'
  },
  {
    kind:'success', title:'Th√†nh c√¥ng b·ªÅn v·ªØng', lead:'ƒêi ch·∫≠m kh√¥ng sao, mi·ªÖn l√† ƒë√∫ng h∆∞·ªõng.',
    body:`Nh·ªØng n·ªó l·ª±c l·∫∑ng th·∫ßm r·ªìi s·∫Ω ƒë∆°m hoa. Ch√∫c em g·∫∑t h√°i nh·ªØng th√†nh t·ª±u x·ª©ng ƒë√°ng t·ª´ng b∆∞·ªõc m·ªôt`,
    image: 'https://scontent.fhan14-3.fna.fbcdn.net/v/t39.30808-6/490656579_2083221608857787_2394165428951879052_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=833d8c&_nc_ohc=MukjMotZXfoQ7kNvwGjXx9Q&_nc_oc=AdkYZIj0fONRUa6rTekBm6CBSdbW7Wf76Egqfju6i55KgBwWbWEe8Cpcp8YF5TBCES0AGSQ-dNmOPhX4pk1zjmmo&_nc_zt=23&_nc_ht=scontent.fhan14-3.fna&_nc_gid=ZrEdbdsb-IDtllokypJZdw&oh=00_AfeDg5KAq0kJBBz02j0A2R0W44GVNjVZunCf3nvPyheR0Q&oe=68FADBFB'
  },
  {
    kind:'happiness', title:'H·∫°nh ph√∫c vi√™n m√£n', lead:'Nh·ªè x√≠u m√† ƒë·∫ßy.',
    body:`M·ªôt b√¥ng hoa nh·ªè, m·ªôt b·∫£n nh·∫°c ∆∞a th√≠ch, m·ªôt tin nh·∫Øn d·ªÖ th∆∞∆°ng:
    Ch√∫c em lu√¥n c√≥ <b>nh·ªØng ni·ªÅm vui nh·ªè</b> ƒë·ªÉ gh√©p th√†nh h·∫°nh ph√∫c l·ªõn. üåπüéµ`,
    image: 'https://scontent.fhan14-3.fna.fbcdn.net/v/t39.30808-6/486674240_2067176310462317_6889303251948558253_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=833d8c&_nc_ohc=KtSh-yYVeL4Q7kNvwFnGe59&_nc_oc=AdkFykq3NmbpLd6prVPrEmZQkM62EFdIqXeceurU-67I1c2OxNyj5ny8bzZWkcAYc4M6g8rhOnEXIbHDrLopnTmo&_nc_zt=23&_nc_ht=scontent.fhan14-3.fna&_nc_gid=6LXFHhIvm1FyuV8z8A1PcQ&oh=00_AfeKrtMIuJhEXXg1f5VfYCb9Z5tC0_SBPfFrDXZtBVEeow&oe=68FAC3AF'
  },
  {
    kind:'shine', title:'Lan t·ªèa t√≠ch c·ª±c', lead:'Em l√† ngu·ªìn s√°ng.',
    body:`Ch√∫c em ti·∫øp t·ª•c <b>lan t·ªèa</b> y√™u th∆∞∆°ng v√† c≈©ng lu√¥n nh·∫≠n l·∫°i ƒëi·ªÅu d·ªãu d√†ng ·∫•y. üåü`,
    image: 'https://scontent.fhan14-1.fna.fbcdn.net/v/t39.30808-6/490021576_2083455475501067_793237374930787615_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=833d8c&_nc_ohc=THNy8q6RCVUQ7kNvwH5gGKG&_nc_oc=Adm2ObOBz0wit0iqSdDMgmYcTsU5epqdk1QbP-biG4kwnQ8se8BOeCyK7rZOdQKmGz1JWG5H90qRWOommN6-SfKR&_nc_zt=23&_nc_ht=scontent.fhan14-1.fna&_nc_gid=xfs9Du3ViMeyMbZqtKL3_w&oh=00_Afe6ME9OI5QfdcMccPUxY-rWY9Tb5g37z3eB-VDvhPT5UQ&oe=68FADBD3'
  }
];

/* ===== Build tiles ===== */
/* ===== T·∫°o grid ===== */
function buildGrid() {
  const g = $('#grid');
  g.innerHTML = '';

  for (const t of tiles) {
    const el = document.createElement('article');
    el.className = 'tile';
    el.dataset.kind = t.kind;
    el.setAttribute('tabindex', '0');

    // n·ªôi dung trong m·ªói tile (ch∆∞a c√≥ ·∫£nh)
    el.innerHTML = `
      <div class="shine"></div>
      <h3>${iconFor(t.kind)} ${t.title}</h3>
      <p>${t.lead}</p>
    `;

    // hi·ªáu ·ª©ng pointer shine
    el.addEventListener('pointermove', e => {
      const r = el.getBoundingClientRect();
      el.style.setProperty('--mx', ((e.clientX - r.left) / r.width * 100) + '%');
      el.style.setProperty('--my', ((e.clientY - r.top) / r.height * 100) + '%');
    });

    // m·ªü panel khi click / Enter / Space
    const open = () => showPanel(t);
    el.addEventListener('click', open);
    el.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        open();
      }
    });

    g.appendChild(el);
  }
}

/* ===== Bi·ªÉu t∆∞·ª£ng cho t·ª´ng lo·∫°i tile ===== */
function iconFor(kind) {
  return {
    beauty: 'üå∏',
    strength: 'üí™',
    success: '‚ú®',
    happiness: '‚ù§Ô∏è',
    shine: 'üåü'
  }[kind] || 'üíñ';
}

/* ===== Hi·ªÉn th·ªã popup panel ===== */
function showPanel(t) {
  // gi·∫£ s·ª≠ b·∫°n ƒë√£ c√≥ 3 ph·∫ßn t·ª≠ n√†y trong HTML
  // <h2 id="ph"></h2>  (ph = panel header)
  // <p id="pl"></p>    (pl = panel lead)
  // <div id="pb"></div> (pb = panel body)
  ph.innerHTML = `${iconFor(t.kind)} ${t.title}`;
  pl.innerHTML = t.lead;

  // th√™m n·ªôi dung v√† ·∫£nh (n·∫øu c√≥)
  pb.innerHTML = `
    <div class="panel-body-text">${t.body}</div>
    ${t.image ? `<img src="${t.image}" alt="${t.title}" class="panel-image">` : ''}
  `;

  panel.classList.add('active');
  panel.setAttribute('aria-hidden', 'false');
  chime(); // √¢m thanh hi·ªáu ·ª©ng n·∫øu b·∫°n c√≥
}

/* ===== ƒê√≥ng panel ===== */
function closePanel() {
  panel.classList.remove('active');
  panel.setAttribute('aria-hidden', 'true');
}

$('#close').addEventListener('click', closePanel);
panel.addEventListener('click', e=>{ if(e.target===panel) closePanel(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closePanel(); });

/* ===== Tiny WebAudio chime (no external file) ===== */
let ac;
function chime(){
  try{
    ac = ac || new (window.AudioContext||window.webkitAudioContext)();
    const o = ac.createOscillator(), g = ac.createGain();
    o.type='triangle'; o.frequency.value=880; // A5
    g.gain.value=.0001;
    o.connect(g).connect(ac.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(.25, ac.currentTime+.02);
    o.frequency.exponentialRampToValueAtTime(1320, ac.currentTime+.18);
    g.gain.exponentialRampToValueAtTime(.0001, ac.currentTime+.28);
    o.stop(ac.currentTime+.3);
  }catch{}
}

/* ===== Background canvas: heart constellation ===== */
let W=0,H=0, parts=[];
function resize(){
  W = bg.width = innerWidth * devicePixelRatio;
  H = bg.height= innerHeight* devicePixelRatio;
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
function heart(t){ // parametric heart curve
  const x = 16*Math.sin(t)**3, y = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
  return {x,y};
}
function initStars(){
  parts=[]; const N=120;
  for(let i=0;i<N;i++){
    const t = Math.random()*Math.PI*2;
    const p = heart(t);
    const px = (p.x*14) + innerWidth/2 + (Math.random()*40-20);
    const py = (-p.y*14) + innerHeight/2 - 40 + (Math.random()*40-20);
    parts.push({x:px,y:py, r:Math.random()*1.6+0.6, a:Math.random()*1, v:(Math.random()*.7+.3)});
  }
}
function tick(){
  ctx.clearRect(0,0,innerWidth,innerHeight);
  // soft space dust
  for(let i=0;i<40;i++){
    const x=Math.random()*innerWidth, y=Math.random()*innerHeight;
    ctx.fillStyle='rgba(255,255,255,.02)'; ctx.fillRect(x,y,1,1);
  }
  // links
  ctx.lineWidth=0.6; ctx.strokeStyle='rgba(255,255,255,.12)'; ctx.beginPath();
  for(let i=0;i<parts.length;i++){
    for(let j=i+1;j<parts.length;j++){
      const dx=parts[i].x-parts[j].x, dy=parts[i].y-parts[j].y;
      const d = Math.hypot(dx,dy);
      if(d<90){ ctx.moveTo(parts[i].x,parts[i].y); ctx.lineTo(parts[j].x,parts[j].y); }
    }
  }
  ctx.stroke();
  // stars
  for(const p of parts){
    p.a += 0.02*p.v;
    const glow = (Math.sin(p.a)*0.5+0.5)*0.8 + 0.2;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r*glow,0,Math.PI*2);
    const grad = ctx.createRadialGradient(p.x,p.y,0, p.x,p.y,p.r*3);
    grad.addColorStop(0, 'rgba(255,255,255,.95)');
    grad.addColorStop(1, 'rgba(255,255,255,.05)');
    ctx.fillStyle = grad; ctx.fill();
  }
  requestAnimationFrame(tick);
}

/* ===== Init ===== */
document.addEventListener('DOMContentLoaded', async ()=>{
  resize(); initStars(); requestAnimationFrame(tick);
  window.addEventListener('resize', ()=>{ resize(); initStars(); });

  if(isInApp()){ ext.style.display='block'; openExt.addEventListener('click', openInBrowser); }

  personalize();
  buildGrid();

  await autoplayMuted(); attachFirstInteraction();

  burst(36);

// Sau ƒë√≥ l·∫∑p l·∫°i m·ªói 3 gi√¢y
  setInterval(() => burst(36), 3000);
  // $('#confetti').addEventListener('click', ()=>burst(36));
  playBtn.addEventListener('click', unmuteAndFade);
});
</script>
</body>
</html>
